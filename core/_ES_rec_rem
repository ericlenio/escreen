# vim:filetype=sh
function _ES_rec_rem() {
  # v is the name of variable we are going to set so caller can
  # get the function
  local v=$1
  local l
  # Delimit the input with a space, and after each line is sent send \r so the
  # terminal does not scroll
  local _s
  while true; do
    read -d ' ' l
    [ "$l" = . ] && break
    _s+=$l$'\n'
    # print to stderr in case stdout has been redirected, e.g. user invoked
    # function like so: myfunc | less
    printf "\015" >&2
  done
  # special case if stdout is piped to something that buffers, like less
  [ ! -t 1 ] && printf ". " >&2
  eval $v='$(echo "$_s"|openssl enc -d -base64|gzip -d -c)'
}
export -f _ES_rec_rem
