# vim:filetype=sh
# _vime: generate wrapped vim executable
#
# calls _esh_i to init the session, to make sure the communication port is
# functional
_vime() {
  local VIMRC=$ESH_TMP/$LOGNAME.editor.vimrc
  _vimrc $VIMRC || return $?
  eval "$(_esh_e)"
  printf '#!/usr/bin/env bash
%s
ESH_PORT=%s _esh_i %s ESH_PORT </dev/null
exec vim -S %s "$@"' \
  "$(_bash_init $ESH_STY)" \
  $ESH_PORT \
  $ESH_STY \
  $VIMRC \
  > $ESH_EDITOR || return $?
  chmod 700 $ESH_EDITOR || {
    echo "ERROR: could not chmod $ESH_EDITOR: $?"
  }
}
