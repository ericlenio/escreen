# vim:filetype=sh
# _vime: generate wrapped vim executable
#
# calls _esh_i to init the session, to make sure the communication port is
# functional
_vime() {
  local VIMRC=$ESH_TMP/$LOGNAME.vimrc
  _vimrc $VIMRC || return $?
  export ESH_EDITOR=$ESH_TMP/$LOGNAME-vim
  export FCEDIT=$ESH_EDITOR VISUAL=$ESH_EDITOR EDITOR=$ESH_EDITOR
  printf '#!/usr/bin/env bash
%s
eval $(_esh_e)
_esh_i %s ESH_PORT </dev/null
exec vim -S %s "$@"' \
  "$(_bash_init $ESH_STY)" \
  $ESH_STY \
  $VIMRC \
  > $ESH_EDITOR || return $?
  chmod 700 $ESH_EDITOR || {
    echo "ERROR: could not chmod $ESH_EDITOR: $?"
  }
}
