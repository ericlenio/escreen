# vim:filetype=sh
# cp2cb: use perl to remove the last \n on the last line (because vim's
# writefile will always put an extra one), and minimally set a hyphen character
# in the stream so as to not pass 0 bytes to clipit (which causes it to block)
cp2cb() {
  if [ ! -t 0 ]; then
    gzip -9 -c | _esh_b setCb
    return
  fi
  local f="$1"
  if [ ! -e "$f" ]; then
    echo "Error: no such file, or file is not readable: $f"
    return 1
  fi
  local c=$(perl -pe 'chomp if eof' -- "$f")
  [ -z "$c" ] && c="-"
  echo "$c" | gzip -9 -c | _esh_b setCb
}
export -f cp2cb
