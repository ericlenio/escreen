# vim:filetype=sh
# cp2cb: use perl to remove the last \n on the last line (because vim's
# writefile will always put an extra one), and minimally set a hyphen character
# in the stream so as to not pass 0 bytes to clipit (which causes it to block)
cp2cb() {
  local f="$1"
  if [ -t 0 ]; then
    if [ ! -e "$f" ]; then
      echo "Error: no such file, or file is not readable: $f"
      return 1
    fi
  else
    f="-"
  fi
  perl -pe 'chomp if eof' -- "$f" | gzip -9 -c | _esh_b setCb
}
export -f cp2cb
