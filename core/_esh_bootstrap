# vim:filetype=bash
#
# _esh_bootstrap bootstraps a function
#
_esh_bootstrap() {
  local f=$1 f0=${1/*.} f1=$(declare -f -- $f0) f2
echo $FUNCNAME:test:$ESH_TERM_AUTH_TOKEN >&2
  shift
  _esh_l $f </dev/null
  f2=$(declare -f -- $f0)
  # compare before and after: if the same, then something went wrong in the
  # uploading/decryption/loading of the function
  if [ "$f1" = "$f2" ]; then
    echo "$FUNCNAME: failed to load $f" >&2
    return 1
  fi
  $f0 "$@"
}
export -f _esh_bootstrap
