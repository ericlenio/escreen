# vim:filetype=sh
# copy_to_clipboard: use perl to remove the last \n on the last line, and
# minimally set a hyphen character in the stream so as to not pass 0 bytes to
# clipit (which causes it to block)
function copy_to_clipboard() {
  local marker=$(_ES_marker COPY_TO_CLIPBOARD)
  local file_to_copy="$1"
  if [ -z "$file_to_copy" ]; then
    file_to_copy="-"
  elif [ ! -e "$file_to_copy" ]; then
    echo "Error: no such file, or file is not readable: $file_to_copy"
    file_to_copy=/dev/null
  fi
  _ES_send_marker "$marker" $(perl -pe 'BEGIN{$n=0;}END{print "-" if $n==0}$n+=length($_);chomp if eof' -- "$file_to_copy")
}
export -f copy_to_clipboard
