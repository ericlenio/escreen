# vim:filetype=bash
tomcatlog() {
  local opts="23ecx" flag=$1 op opt tcuser=$(grep -w tomcat. /etc/passwd | tail -1 | cut -d: -f1)
  # if ssh-ing to remote system with odd/custom tomcat setup: create
  # /etc/escreen.sshrc and set ESH_TOMCATLOG and ESH_TOMCATLOGUSER
  local logfile=${ESH_TOMCATLOG:-/var/log/$tcuser/catalina.out}
  local tomcat_user=${ESH_TOMCATLOGUSER:-$tcuser}
  while getopts $opts opt; do
    case "$opt" in
      2) # for LincDoc 2.x
        logfile=/var/log/lincdoc/catalina.out
        tomcat_user=tomcat
        shift
        ;;
      3) # for LincDoc 3.0
        logfile=/var/log/lincdoc/catalina.log
        tomcat_user=tomcat
        shift
        ;;
      e) op=edit; shift;;
      c) op=clear; shift;;
      x) op=exceptions; shift;;
    esac
  done
  if [ "$op" = "edit" ]; then
    s $tomcat_user vim -R -n -i NONE -c 'map <c-z> :e<cr>:echon bufname("%") " was reloaded from disk"<cr>' $logfile
  elif [ "$op" = "clear" ]; then
    sudo truncate --no-create --size 0 $logfile
    echo "$logfile was truncated."
  elif [ "$op" = "exceptions" ]; then
    sudo -u $tomcat_user grep Exception $logfile
  else
    sudo -E -H -u $tomcat_user tail -f $logfile
  fi
}
export -f tomcatlog
